{% extends 'base.html' %}

{% block content %}

<hr>
<div class="row">
  <div class="col-12">

    <h3>{{ user.first_name }} {{ user.last_name }}</h3>
    <a href="{% url 'user_update' user.pk %}">Update name</a><br>
    <a href="{% url 'account_change_password' %}">Change password</a><br>
    <hr>
    Date Joined - {{ user.date_joined }}
    <hr>
    <h5>Subscribe</h5>
    <p>Trial ends on {{ profile.trial_end }}</p>
    <button class="btn btn-secondary" id="checkout-button-plan_FZhtfxftM44uHz" role="link">
      Monthly
    </button>
    <span>- or -</span>
    <button class="btn btn-secondary" id="checkout-button-plan_FaRGVsApeXu8bS" role="link">
      Yearly
    </button>

    <hr>
    <h5>Email</h5> {{ user.email }}<br>
    <a href="{% url 'account_email' %}">Update email</a><br>

    <hr>
    <h5>Company</h5> {{ user.profile.company }}
    <hr>
    <h5>Medical Certificate</h5>
    Issued - {{ user.profile.date }} |
    Type -
    {% if user.profile.first_class == True %} 1st Class |{% else %}{% endif %}
    {% if user.profile.second_class == True %} 2nd Class |{% else %}{% endif %}
    {% if user.profile.third_class == True %} 3rd Class |{% else %}{% endif %}
    {% if user.profile.over_40 == True %} Over 40 {% else %}{% endif %}
    <hr>
    <p>Questions or problems with the app? Email us <a target="new" href="mailto:support@direct2logbook.com?subject=Support">here</a></p>
    <p>Include a screenshot if possible, and a description of the error. More info is better</p>
    <hr>
    <p><a class="btn-shadow btn-shadow-dark btn-block" href="{% url 'profile_update' user.profile.pk %}">Update Profile</a></p>
  </div>
</div>

<script src="https://js.stripe.com/v3/"></script>

<!-- Load Stripe.js on your website. -->
<script src="https://js.stripe.com/v3"></script>

<!-- Create a button that your customers click to complete their purchase. Customize the styling to suit your branding. -->


<div id="error-message"></div>

<script>
  var stripe = Stripe('pk_test_Z9KJ4TxX7nY9hcXA297CV7QK002fT3EcFo');

  var checkoutButton = document.getElementById('checkout-button-plan_FZhtfxftM44uHz');
  checkoutButton.addEventListener('click', function () {
    // When the customer clicks on the button, redirect
    // them to Checkout.
    stripe.redirectToCheckout({
      items: [{plan: 'plan_FZhtfxftM44uHz', quantity: 1}],

      // Do not rely on the redirect to the successUrl for fulfilling
      // purchases, customers may not always reach the success_url after
      // a successful payment.
      // Instead use one of the strategies described in
      // https://stripe.com/docs/payments/checkout/fulfillment
      successUrl: window.location.protocol + '//www.direct2logbook.com/payments/success',
      cancelUrl: window.location.protocol + '//www.direct2logbook.com/payments/canceled',
      customerEmail: '{{ user.email }}',
    })
    .then(function (result) {
      if (result.error) {
        // If `redirectToCheckout` fails due to a browser or network
        // error, display the localized error message to your customer.
        var displayError = document.getElementById('error-message');
        displayError.textContent = result.error.message;
      }
    });
  });
</script>
<!-- Load Stripe.js on your website. -->
<script src="https://js.stripe.com/v3"></script>

<!-- Create a button that your customers click to complete their purchase. Customize the styling to suit your branding. -->


<div id="error-message"></div>

<script>
  var stripe = Stripe('pk_test_Z9KJ4TxX7nY9hcXA297CV7QK002fT3EcFo');

  var checkoutButton = document.getElementById('checkout-button-plan_FaRGVsApeXu8bS');
  checkoutButton.addEventListener('click', function () {
    // When the customer clicks on the button, redirect
    // them to Checkout.
    stripe.redirectToCheckout({
      items: [{plan: 'plan_FaRGVsApeXu8bS', quantity: 1}],

      // Do not rely on the redirect to the successUrl for fulfilling
      // purchases, customers may not always reach the success_url after
      // a successful payment.
      // Instead use one of the strategies described in
      // https://stripe.com/docs/payments/checkout/fulfillment
      successUrl: window.location.protocol + '//www.direct2logbook.com/payments/success',
      cancelUrl: window.location.protocol + '//www.direct2logbook.com/payments/canceled',
      customerEmail: '{{ user.email }}'
    })
    .then(function (result) {
      if (result.error) {
        // If `redirectToCheckout` fails due to a browser or network
        // error, display the localized error message to your customer.
        var displayError = document.getElementById('error-message');
        displayError.textContent = result.error.message;
      }
    });
  });
</script>

{% endblock %}
